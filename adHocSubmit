// This script enables the user to submit inputs to the stock db. It works for all the various submit buttons on the 'submit' sheet

function onEdit(e) {

  console.log(JSON.stringify(e));

  const sh=e.range.getSheet();
  
  
  if(sh.getName()=="submit" && e.value=="Submit") {  //If user chooses "submit" then execute this

    var ss        = SpreadsheetApp.getActiveSpreadsheet();
    var formSS    = ss.getSheetByName("submit"); //Data entry Sheet
    var dbsheet   = ss.getSheetByName("database"); //Data Sheet
    var submitCol = e.range.columnStart; //Determine column of the submit button that was triggered
    var submitRow = e.range.rowStart; //Determine row of the submit button that was triggered
    var manualRange = formSS.getRange((submitRow), 4, 1, (submitCol - 3)); // The row where the user can manually provide inputs "New Data for DB"
    var range = formSS.getRange((submitRow+1), 3, 1, (submitCol - 3));
    var values = range.getValues();
    Logger.log(values);
     
    dbsheet.getRange(dbsheet.getLastRow()+1, 1, 1,submitCol-3).setValues(values); // Add a new row to the db sheet and copy the array to that row

    e.source.toast(formSS.getRange((submitRow-1),3).getValue()+' ('+formSS.getRange((submitRow-1),7).getValue()+') successfully updated', 'Success!');

    manualRange.clearContent(); // Clear the contents of the manual entry row (the row labeled "New Data for DB")

  }
  

// If "clear" is selected then clear all input fields
if(sh.getName()=="submit" && e.value=="Clear") {

    var ss        = SpreadsheetApp.getActiveSpreadsheet();
    var formSS    = ss.getSheetByName("submit"); //Data entry Sheet
    var submitCol = e.range.columnStart; //Determine column of the submit button that was triggered
    var submitRow = e.range.rowStart; //Determine row of the submit button that was triggered
    var manualRange = formSS.getRange((submitRow), 4, 1, (submitCol - 3)); // The row where the user can manually provide inputs "New Data for DB"    
    var ticker = formSS.getRange((submitRow-1), 3, 1, 1);

    ticker.clearContent();
    manualRange.clearContent();

        
  }

}
